<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="APIæµ‹è¯•é¡µé¢">
    <meta name="keywords" content="APIã€æµ‹è¯•ã€Dockerã€é•œåƒæœç´¢">
    <meta name="color-scheme" content="dark light">
    <title>APIæµ‹è¯•é¡µé¢</title>
    <link rel="icon" href="/favicon.ico">
    <style>
        :root {
            --background: #ffffff;
            --foreground: #0f172a;
            --card: #ffffff;
            --card-foreground: #0f172a;
            --primary: #2563eb;
            --primary-foreground: #f8fafc;
            --secondary: #f1f5f9;
            --secondary-foreground: #0f172a;
            --muted: #f1f5f9;
            --muted-foreground: #64748b;
            --accent: #f1f5f9;
            --accent-foreground: #0f172a;
            --border: #e2e8f0;
            --input: #ffffff;
            --ring: #2563eb;
            --radius: 0.5rem;
        }

        .dark {
            --background: #0f172a;
            --foreground: #f8fafc;
            --card: #1e293b;
            --card-foreground: #f8fafc;
            --primary: #3b82f6;
            --primary-foreground: #f8fafc;
            --secondary: #1e293b;
            --secondary-foreground: #f8fafc;
            --muted: #1e293b;
            --muted-foreground: #94a3b8;
            --accent: #1e293b;
            --accent-foreground: #f8fafc;
            --border: #334155;
            --input: #1e293b;
            --ring: #3b82f6;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --background: #0f172a;
                --foreground: #f8fafc;
                --card: #1e293b;
                --card-foreground: #f8fafc;
                --primary: #3b82f6;
                --primary-foreground: #f8fafc;
                --secondary: #1e293b;
                --secondary-foreground: #f8fafc;
                --muted: #1e293b;
                --muted-foreground: #94a3b8;
                --accent: #1e293b;
                --accent-foreground: #f8fafc;
                --border: #334155;
                --input: #1e293b;
                --ring: #3b82f6;
            }
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: var(--background);
            color: var(--foreground);
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.3s, color 0.3s;
        }

        .navbar {
            position: sticky !important;
            top: 0 !important;
            z-index: 50 !important;
            width: 100% !important;
            border-bottom: 1px solid var(--border) !important;
            background-color: var(--background) !important;
            backdrop-filter: blur(8px) !important;
            background-color: rgba(255, 255, 255, 0.95) !important;
            padding: 0 !important;
            margin: 0 !important;
        }

        .dark .navbar {
            background-color: rgba(15, 23, 42, 0.95) !important;
        }

        .navbar-container {
            max-width: 1200px !important;
            margin: 0 auto !important;
            padding: 0 1rem !important;
            display: flex !important;
            align-items: center !important;
            justify-content: space-between !important;
            height: 4rem !important;
        }

        .logo {
            display: flex !important;
            align-items: center !important;
            gap: 0.5rem !important;
            text-decoration: none !important;
            color: var(--foreground) !important;
            font-weight: 600 !important;
            font-size: 1.125rem !important;
        }

        .logo-icon {
            width: 2rem !important;
            height: 2rem !important;
            border-radius: 0.5rem !important;
            background: linear-gradient(135deg, var(--primary), #3b82f6) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            color: white !important;
        }

        .nav-links {
            display: flex !important;
            align-items: center !important;
            gap: 0.5rem !important;
        }

        .nav-link {
            padding: 0.5rem 1rem !important;
            border-radius: var(--radius) !important;
            text-decoration: none !important;
            color: var(--muted-foreground) !important;
            transition: all 0.2s !important;
            font-weight: 500 !important;
        }

        .nav-link:hover,
        .nav-link.active {
            color: var(--foreground) !important;
            background-color: var(--muted) !important;
        }

        .theme-toggle {
            padding: 0.5rem !important;
            border: none !important;
            border-radius: var(--radius) !important;
            background-color: transparent !important;
            color: var(--muted-foreground) !important;
            cursor: pointer !important;
            transition: all 0.2s !important;
        }

        .theme-toggle:hover {
            background-color: var(--muted) !important;
            color: var(--foreground) !important;
        }

        .main {
            flex: 1;
            padding: 2rem 1rem;
            min-height: calc(100vh - 4rem);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }

        h1 {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--primary);
            font-size: 2rem;
        }
        
        .mobile-menu-toggle {
            display: none;
        }

        .icon {
            display: inline-block;
            vertical-align: middle;
            margin-right: 4px;
            margin-top: -2px;
        }
        
        @media (max-width: 768px) {
            .nav-links {
                position: fixed;
                top: 70px;
                left: 0;
                right: 0;
                background: var(--background);
                border: 1px solid var(--border);
                border-top: none;
                border-radius: 0 0 12px 12px;
                padding: 1rem;
                flex-direction: column;
                gap: 0.5rem;
                z-index: 1000;
                transform: translateY(-100vh);
                transition: transform 0.3s ease;
            }
            
            .nav-links.active {
                transform: translateY(0);
            }
            
            .mobile-menu-toggle {
                display: block !important;
                background: none;
                border: none;
                color: var(--foreground);
                font-size: 1.5rem;
                cursor: pointer;
                padding: 0.5rem;
                border-radius: var(--radius);
                transition: background-color 0.2s;
            }
            
            .mobile-menu-toggle:hover {
                background-color: var(--muted);
            }
            
            .navbar-container {
                justify-content: space-between !important;
            }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        h1 {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--primary);
            font-size: 2rem;
        }

        .search-section {
            background: var(--card);
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            border: 1px solid var(--border);
        }

        .form-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .input-group {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--foreground);
        }

        input[type="text"] {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background-color: var(--input);
            color: var(--foreground);
            font-size: 1rem;
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        button {
            padding: 0.75rem 1.5rem;
            background-color: var(--primary);
            color: var(--primary-foreground);
            border: none;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.2s;
        }

        button:hover {
            background-color: #1d4ed8;
            transform: translateY(-2px);
        }

        button:disabled {
            background-color: var(--muted);
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            margin-top: 2rem;
        }

        .result-card {
            background-color: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .result-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary);
        }

        .result-source {
            font-size: 0.9rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            background-color: var(--secondary);
        }

        .result-content {
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
            background-color: var(--muted);
            padding: 1rem;
            border-radius: var(--radius);
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .result-summary {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: var(--secondary);
            border-radius: var(--radius);
        }
        
        .summary-item {
            display: flex;
            flex-direction: column;
        }
        
        .summary-label {
            font-size: 0.8rem;
            color: var(--muted-foreground);
            margin-bottom: 0.25rem;
        }
        
        .summary-value {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .api-endpoint {
            font-family: monospace;
            background-color: var(--muted);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
            margin: 0.5rem 0;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--muted-foreground);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--muted);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-indicator {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-success {
            background-color: #d4edda;
            color: #155724;
        }

        .status-error {
            background-color: #f8d7da;
            color: #721c24;
        }

        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .tabs {
            display: flex;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: 500;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .form-group {
                flex-direction: column;
            }
            
            .btn-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .result-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <a href="/" class="logo">
                <div class="logo-icon">
                    âš¡
                </div>
                åŠ é€ŸæœåŠ¡
            </a>
            
            <button class="mobile-menu-toggle" id="mobileMenuToggle">
                â˜°
            </button>
            
            <div class="nav-links" id="navLinks">
                <a href="/" class="nav-link">ğŸš€ GitHubåŠ é€Ÿ</a>
                <a href="/images.html" class="nav-link">ğŸ³ ç¦»çº¿é•œåƒä¸‹è½½</a>
                <a href="/search.html" class="nav-link">ğŸ” é•œåƒæœç´¢</a>
                <a href="/test_api.html" class="nav-link active">ğŸ§ª APIæµ‹è¯•</a>
                
                <button class="theme-toggle" id="themeToggle">
                    ğŸŒ™
                </button>
            </div>
        </div>
    </nav>

    <main class="main">
        <div class="container">
            <h1>APIæµ‹è¯•é¡µé¢</h1>

            <div class="search-section">
                <div class="form-group">
                    <div class="input-group">
                        <label for="searchQuery">æœç´¢å…³é”®è¯</label>
                        <input type="text" id="searchQuery" placeholder="è¾“å…¥æœç´¢å…³é”®è¯ï¼Œä¾‹å¦‚: litellm" value="litellm">
                    </div>
                    <div class="input-group">
                        <label>&nbsp;</label>
                        <div class="btn-group">
                            <button type="button" id="testSingle">æµ‹è¯•å•ä¸€æœç´¢</button>
                            <button type="button" id="testMultiSeparate">æµ‹è¯•å¤šæºåˆ†ç¦»</button>
                            <button type="button" id="testMultiMerged">æµ‹è¯•å¤šæºåˆå¹¶</button>
                            <button type="button" id="testAllSources">æµ‹è¯•å…¨éƒ¨æº</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tabs">
                <div class="tab active" data-tab="single">å•ä¸€æœç´¢</div>
                <div class="tab" data-tab="multi-separate">å¤šæºåˆ†ç¦»</div>
                <div class="tab" data-tab="multi-merged">å¤šæºåˆå¹¶</div>
                <div class="tab" data-tab="individual">ç‹¬ç«‹æºæµ‹è¯•</div>
            </div>

            <div class="results-section">
                <div id="singleTab" class="tab-content active">
                    <h3>å•ä¸€æœç´¢ç»“æœ</h3>
                    <div id="singleResults"></div>
                </div>

                <div id="multiSeparateTab" class="tab-content">
                    <h3>å¤šæºåˆ†ç¦»æœç´¢ç»“æœ</h3>
                    <div id="multiSeparateResults"></div>
                </div>

                <div id="multiMergedTab" class="tab-content">
                    <h3>å¤šæºåˆå¹¶æœç´¢ç»“æœ</h3>
                    <div id="multiMergedResults"></div>
                </div>

                <div id="individualTab" class="tab-content">
                    <h3>ç‹¬ç«‹æºæµ‹è¯•ç»“æœ</h3>
                    <div id="individualResults"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Tabåˆ‡æ¢åŠŸèƒ½
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨æ ‡ç­¾
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // æ¿€æ´»å½“å‰æ ‡ç­¾
                tab.classList.add('active');
                const tabId = `${tab.dataset.tab}Tab`;
                const targetTabContent = document.getElementById(tabId);
                if (targetTabContent) {
                    targetTabContent.classList.add('active');
                }
                
                // å¦‚æœåˆ‡æ¢åˆ°æŸé€‰é¡¹å¡ä¸”å¯¹åº”å†…å®¹åŒºåŸŸä¸ºç©ºï¼Œè‡ªåŠ¨æ‰§è¡Œæœç´¢
                const query = document.getElementById('searchQuery').value.trim();
                if (query && query !== '') {
                    // æ£€æŸ¥å¯¹åº”çš„ç»“æœåŒºåŸŸæ˜¯å¦ä¸ºç©º
                    let shouldAutoSearch = false;
                    let resultsContainerId = '';
                    
                    if (tab.dataset.tab === 'multi-separate') {
                        resultsContainerId = 'multiSeparateResults';
                        shouldAutoSearch = true;
                    } else if (tab.dataset.tab === 'multi-merged') {
                        resultsContainerId = 'multiMergedResults';
                        shouldAutoSearch = true;
                    } else if (tab.dataset.tab === 'single') {
                        resultsContainerId = 'singleResults';
                        shouldAutoSearch = true;
                    } else if (tab.dataset.tab === 'individual') {
                        resultsContainerId = 'individualResults';
                        shouldAutoSearch = true;
                    }
                    
                    if (shouldAutoSearch) {
                        const resultsContainer = document.getElementById(resultsContainerId);
                        // åªæœ‰å½“ç»“æœå®¹å™¨ä¸ºç©ºæˆ–åªåŒ…å«åˆå§‹å†…å®¹æ—¶æ‰è‡ªåŠ¨æœç´¢
                        if (resultsContainer && 
                            (resultsContainer.innerHTML.trim() === '' || 
                             resultsContainer.querySelector('.loading'))) {
                            // æ ¹æ®é€‰é¡¹å¡ç±»å‹æ‰§è¡Œç›¸åº”çš„æœç´¢
                            if (tab.dataset.tab === 'multi-separate') {
                                testMultiSeparateSearch();
                            } else if (tab.dataset.tab === 'multi-merged') {
                                testMultiMergedSearch();
                            } else if (tab.dataset.tab === 'single') {
                                testSingleSearch();
                            } else if (tab.dataset.tab === 'individual') {
                                testIndividualSources();
                            }
                        }
                    }
                } else {
                    // å¦‚æœæ²¡æœ‰æŸ¥è¯¢è¯ï¼Œåˆ™åœ¨é€‰é¡¹å¡ä¸­æ˜¾ç¤ºæç¤ºä¿¡æ¯
                    let resultsContainerId = '';
                    let placeholderTitle = '';
                    let placeholderContent = '';
                    
                    if (tab.dataset.tab === 'multi-separate') {
                        resultsContainerId = 'multiSeparateResults';
                        placeholderTitle = 'å¤šæºåˆ†ç¦»æœç´¢';
                        placeholderContent = 'è¯·è¾“å…¥æœç´¢å…³é”®è¯ä»¥æ‰§è¡Œå¤šæºåˆ†ç¦»æœç´¢ã€‚å¤šæºåˆ†ç¦»æœç´¢ä¼šä»å¤šä¸ªé•œåƒä»“åº“ï¼ˆå¦‚Docker Hubã€GHCRã€GCRç­‰ï¼‰åˆ†åˆ«è·å–ç»“æœå¹¶å•ç‹¬æ˜¾ç¤ºã€‚';
                    } else if (tab.dataset.tab === 'multi-merged') {
                        resultsContainerId = 'multiMergedResults';
                        placeholderTitle = 'å¤šæºåˆå¹¶æœç´¢';
                        placeholderContent = 'è¯·è¾“å…¥æœç´¢å…³é”®è¯ä»¥æ‰§è¡Œå¤šæºåˆå¹¶æœç´¢ã€‚å¤šæºåˆå¹¶æœç´¢ä¼šä»å¤šä¸ªé•œåƒä»“åº“è·å–ç»“æœå¹¶åˆå¹¶æ˜¾ç¤ºã€‚';
                    } else if (tab.dataset.tab === 'single') {
                        resultsContainerId = 'singleResults';
                        placeholderTitle = 'å•ä¸€æœç´¢';
                        placeholderContent = 'è¯·è¾“å…¥æœç´¢å…³é”®è¯ä»¥æ‰§è¡Œå•ä¸€æœç´¢ã€‚';
                    } else if (tab.dataset.tab === 'individual') {
                        resultsContainerId = 'individualResults';
                        placeholderTitle = 'ç‹¬ç«‹æºæµ‹è¯•';
                        placeholderContent = 'è¯·è¾“å…¥æœç´¢å…³é”®è¯ä»¥æµ‹è¯•å„ä¸ªç‹¬ç«‹çš„é•œåƒä»“åº“æºã€‚';
                    }
                    
                    const resultsContainer = document.getElementById(resultsContainerId);
                    if (resultsContainer && resultsContainer.innerHTML.trim() === '') {
                        resultsContainer.innerHTML = `<div class="result-card">
                            <div class="result-header">
                                <div class="result-title">${placeholderTitle}</div>
                                <div class="result-source status-indicator status-pending">å¾…æ‰§è¡Œ</div>
                            </div>
                            <div class="result-content">${placeholderContent}</div>
                        </div>`;
                    }
                }
            });
        });

        // æµ‹è¯•å‡½æ•°
        async function testSingleSearch() {
            const query = document.getElementById('searchQuery').value.trim();
            if (!query) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }

            const resultsDiv = document.getElementById('singleResults');
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨æœç´¢...</div>';

            try {
                const response = await fetch(`/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                displayResult(resultsDiv, 'Docker Hub æœç´¢', 'docker.io', data, response.status);
            } catch (error) {
                // å³ä½¿å‡ºç°é”™è¯¯ï¼Œä¹Ÿæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯è€Œä¸æ˜¯éšè—ç»“æœ
                resultsDiv.innerHTML = `<div class="result-card">
                    <div class="result-header">
                        <div class="result-title">Docker Hub æœç´¢</div>
                        <div class="result-source status-indicator status-error">Error</div>
                    </div>
                    <div class="result-content">${error.message}</div>
                </div>`;
            }
        }

        async function testMultiSeparateSearch() {
            const query = document.getElementById('searchQuery').value.trim();
            if (!query) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }

            const resultsDiv = document.getElementById('multiSeparateResults');
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨æœç´¢å¤šä¸ªæº...</div>';

            try {
                const startTime = Date.now();
                const response = await fetch(`/search?q=${encodeURIComponent(query)}&multi_source=true`);
                const responseTime = Date.now() - startTime;
                const data = await response.json();
                
                console.log('å¤šæºåˆ†ç¦»æœç´¢å“åº”:', data); // è°ƒè¯•ä¿¡æ¯
                
                // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
                if (data.error || data.Error) {
                    resultsDiv.innerHTML = `<div class="result-card">
                        <div class="result-header">
                            <div class="result-title">å¤šæºåˆ†ç¦»æœç´¢</div>
                            <div class="result-source status-indicator status-error">Error</div>
                        </div>
                        <div class="result-summary">
                            <div class="summary-item">
                                <span class="summary-label">HTTPçŠ¶æ€ç </span>
                                <span class="summary-value">${response.status}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">å“åº”æ—¶é—´</span>
                                <span class="summary-value">${responseTime}ms</span>
                            </div>
                        </div>
                        <div class="result-content">æœåŠ¡å™¨è¿”å›é”™è¯¯: ${data.error || data.Error}</div>
                    </div>`;
                    return;
                }
                
                if (data.multi_source_results && Array.isArray(data.multi_source_results)) {
                    resultsDiv.innerHTML = '';
                    
                    // æ˜¾ç¤ºæ€»ä½“æ‘˜è¦
                    const totalSources = data.multi_source_results.length;
                    const successfulSources = data.multi_source_results.filter(r => !(r.Error || r.error)).length;
                    const totalResults = data.multi_source_results.reduce((sum, r) => 
                        sum + (r.Results ? r.Results.length : r.results ? r.results.length : 0), 0);
                    
                    const summaryCard = document.createElement('div');
                    summaryCard.className = 'result-card';
                    summaryCard.innerHTML = `
                        <div class="result-header">
                            <div class="result-title">å¤šæºåˆ†ç¦»æœç´¢ - æ¦‚è§ˆ</div>
                            <div class="result-source status-indicator status-success">Summary</div>
                        </div>
                        <div class="result-summary">
                            <div class="summary-item">
                                <span class="summary-label">HTTPçŠ¶æ€ç </span>
                                <span class="summary-value">${response.status}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">å“åº”æ—¶é—´</span>
                                <span class="summary-value">${responseTime}ms</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">æ•°æ®æºæ•°é‡</span>
                                <span class="summary-value">${totalSources}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">æˆåŠŸæºæ•°</span>
                                <span class="summary-value">${successfulSources}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">æ€»ç»“æœæ•°</span>
                                <span class="summary-value">${totalResults}</span>
                            </div>
                        </div>
                    `;
                    resultsDiv.appendChild(summaryCard);
                    
                    if (totalResults === 0 && successfulSources === 0) {
                        const noResultsCard = document.createElement('div');
                        noResultsCard.className = 'result-card';
                        noResultsCard.innerHTML = `
                            <div class="result-header">
                                <div class="result-title">æç¤º</div>
                                <div class="result-source status-indicator status-error">æ— ç»“æœ</div>
                            </div>
                            <div class="result-content">æ‰€æœ‰æ•°æ®æºå‡æœªè¿”å›ç»“æœã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºï¼š
                                1. æœç´¢çš„é•œåƒåç§°ä¸å­˜åœ¨
                                2. ç½‘ç»œè¿æ¥é—®é¢˜å¯¼è‡´APIè°ƒç”¨å¤±è´¥
                                3. æœç´¢è¯è¿‡äºç‰¹æ®Šï¼Œæ²¡æœ‰åŒ¹é…é¡¹
                                4. éƒ¨åˆ†æ³¨å†Œè¡¨æš‚æ—¶ä¸å¯ç”¨
                                
                                è¯·å°è¯•ä½¿ç”¨æ›´å¸¸è§çš„æœç´¢è¯ï¼Œå¦‚ "nginx"ã€"redis" æˆ– "alpine"ã€‚
                            </div>
                        `;
                        resultsDiv.appendChild(noResultsCard);
                    }
                    
                    // æ˜¾ç¤ºæ¯ä¸ªæºçš„è¯¦ç»†ç»“æœ
                    data.multi_source_results.forEach(result => {
                        const title = `${result.Source || result.source || 'Unknown'} æœç´¢ç»“æœ`;
                        const hasError = result.Error || result.error;
                        const status = hasError ? 'error' : (result.Results && result.Results.length > 0) || (result.results && result.results.length > 0) ? 'success' : 'pending';
                        const statusText = hasError ? 'Error' : (result.Results && result.Results.length > 0) || (result.results && result.results.length > 0) ? 'Success' : 'No Results';
                        const resultCount = result.Results ? result.Results.length : result.results ? result.results.length : 0;
                        
                        const resultCard = document.createElement('div');
                        resultCard.className = 'result-card';
                        resultCard.innerHTML = `
                            <div class="result-header">
                                <div class="result-title">${title}</div>
                                <div class="result-source status-indicator status-${status}">${statusText}</div>
                            </div>
                            <div class="result-summary">
                                <div class="summary-item">
                                    <span class="summary-label">ç»“æœæ•°é‡</span>
                                    <span class="summary-value">${resultCount}</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">è®¡æ•°</span>
                                    <span class="summary-value">${result.Count || result.count || 0}</span>
                                </div>
                            </div>
                            <div class="result-content">${JSON.stringify(result, null, 2)}</div>
                        `;
                        resultsDiv.appendChild(resultCard);
                    });
                } else {
                    resultsDiv.innerHTML = `<div class="result-card">
                        <div class="result-header">
                            <div class="result-title">å¤šæºåˆ†ç¦»æœç´¢</div>
                            <div class="result-source status-indicator status-error">Error</div>
                        </div>
                        <div class="result-summary">
                            <div class="summary-item">
                                <span class="summary-label">HTTPçŠ¶æ€ç </span>
                                <span class="summary-value">${response.status}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">å“åº”æ—¶é—´</span>
                                <span class="summary-value">${responseTime}ms</span>
                            </div>
                        </div>
                        <div class="result-content">æ²¡æœ‰è¿”å›é¢„æœŸçš„æ•°æ®æ ¼å¼ã€‚å“åº”å†…å®¹: ${JSON.stringify(data)}</div>
                    </div>`;
                }
            } catch (error) {
                console.error('å¤šæºåˆ†ç¦»æœç´¢é”™è¯¯:', error); // è°ƒè¯•ä¿¡æ¯
                // å³ä½¿å‡ºç°é”™è¯¯ï¼Œä¹Ÿæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯è€Œä¸æ˜¯éšè—ç»“æœ
                resultsDiv.innerHTML = `<div class="result-card">
                    <div class="result-header">
                        <div class="result-title">å¤šæºåˆ†ç¦»æœç´¢</div>
                        <div class="result-source status-indicator status-error">Error</div>
                    </div>
                    <div class="result-content">æœç´¢å‘ç”Ÿé”™è¯¯: ${error.message}<br>è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</div>
                </div>`;
            }
        }

        async function testMultiMergedSearch() {
            const query = document.getElementById('searchQuery').value.trim();
            if (!query) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }

            const resultsDiv = document.getElementById('multiMergedResults');
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨æœç´¢...</div>';

            try {
                const startTime = Date.now();
                const response = await fetch(`/search?q=${encodeURIComponent(query)}&multi_source=true&merged=true`);
                const responseTime = Date.now() - startTime;
                const data = await response.json();
                
                console.log('å¤šæºåˆå¹¶æœç´¢å“åº”:', data); // è°ƒè¯•ä¿¡æ¯
                
                // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
                if (data.error || data.Error) {
                    resultsDiv.innerHTML = `<div class="result-card">
                        <div class="result-header">
                            <div class="result-title">å¤šæºåˆå¹¶æœç´¢</div>
                            <div class="result-source status-indicator status-error">Error</div>
                        </div>
                        <div class="result-summary">
                            <div class="summary-item">
                                <span class="summary-label">HTTPçŠ¶æ€ç </span>
                                <span class="summary-value">${response.status}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">å“åº”æ—¶é—´</span>
                                <span class="summary-value">${responseTime}ms</span>
                            </div>
                        </div>
                        <div class="result-content">æœåŠ¡å™¨è¿”å›é”™è¯¯: ${data.error || data.Error}</div>
                    </div>`;
                    return;
                }
                
                // è®¡ç®—ç»“æœæ‘˜è¦
                let resultCount = 0;
                if (data.results) {
                    resultCount = Array.isArray(data.results) ? data.results.length : 0;
                }
                
                // æ£€æŸ¥æ˜¯å¦æœ‰ç»“æœ
                const hasAnyResults = resultCount > 0;
                
                // ç¡®å®šçŠ¶æ€å’Œæ–‡æœ¬
                const finalStatus = hasAnyResults ? 'success' : 'pending';
                const finalStatusText = hasAnyResults ? 'Success' : 'No Results';
                
                resultsDiv.innerHTML = `
                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-title">å¤šæºåˆå¹¶æœç´¢</div>
                            <div class="result-source status-indicator status-${finalStatus}">${finalStatusText}</div>
                        </div>
                        <div class="result-summary">
                            <div class="summary-item">
                                <span class="summary-label">HTTPçŠ¶æ€ç </span>
                                <span class="summary-value">${response.status}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">å“åº”æ—¶é—´</span>
                                <span class="summary-value">${responseTime}ms</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">ç»“æœæ•°é‡</span>
                                <span class="summary-value">${resultCount}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">æ•°æ®æºæ•°é‡</span>
                                <span class="summary-value">å¤šä¸ªæº</span>
                            </div>
                        </div>
                        ${!hasAnyResults ? `
                        <div class="result-content">æ‰€æœ‰æ•°æ®æºå‡æœªè¿”å›ç»“æœã€‚è¿™å¯èƒ½æ˜¯å› ä¸ºï¼š
                            1. æœç´¢çš„é•œåƒåç§°ä¸å­˜åœ¨
                            2. ç½‘ç»œè¿æ¥é—®é¢˜å¯¼è‡´APIè°ƒç”¨å¤±è´¥
                            3. æœç´¢è¯è¿‡äºç‰¹æ®Šï¼Œæ²¡æœ‰åŒ¹é…é¡¹
                            4. éƒ¨åˆ†æ³¨å†Œè¡¨æš‚æ—¶ä¸å¯ç”¨
                            
                            è¯·å°è¯•ä½¿ç”¨æ›´å¸¸è§çš„æœç´¢è¯ï¼Œå¦‚ "nginx"ã€"redis" æˆ– "alpine"ã€‚
                        </div>` : `
                        <div class="result-content">å“åº”æ•°æ®:\n${JSON.stringify(data, null, 2)}</div>`}
                    </div>
                `;
            } catch (error) {
                console.error('å¤šæºåˆå¹¶æœç´¢é”™è¯¯:', error); // è°ƒè¯•ä¿¡æ¯
                // å³ä½¿å‡ºç°é”™è¯¯ï¼Œä¹Ÿæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯è€Œä¸æ˜¯éšè—ç»“æœ
                resultsDiv.innerHTML = `<div class="result-card">
                    <div class="result-header">
                        <div class="result-title">å¤šæºåˆå¹¶æœç´¢</div>
                        <div class="result-source status-indicator status-error">Error</div>
                    </div>
                    <div class="result-summary">
                        <div class="summary-item">
                            <span class="summary-label">é”™è¯¯ç±»å‹</span>
                            <span class="summary-value">${error.name}</span>
                        </div>
                    </div>
                    <div class="result-content">æœç´¢å‘ç”Ÿé”™è¯¯: ${error.message}<br>è¯·æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</div>
                </div>`;
            }
        }

        async function testIndividualSources() {
            const query = document.getElementById('searchQuery').value.trim();
            if (!query) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }

            const resultsDiv = document.getElementById('individualResults');
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨æµ‹è¯•å„ä¸ªæº...</div>';

            // æµ‹è¯•æ¯ä¸ªæºçš„ç‹¬ç«‹ç«¯ç‚¹
            const sources = [
                { name: 'Docker Hub', endpoint: `/search?q=${encodeURIComponent(query)}`, source: 'docker.io' },
                { name: 'GHCR', endpoint: `/search?q=${encodeURIComponent(query)}&multi_source=true&merged=true`, source: 'ghcr.io' },
                { name: 'GCR', endpoint: `/search?q=${encodeURIComponent(query)}&multi_source=true&merged=true`, source: 'gcr.io' },
                { name: 'Quay.io', endpoint: `/search?q=${encodeURIComponent(query)}&multi_source=true&merged=true`, source: 'quay.io' },
                { name: 'K8s Registry', endpoint: `/search?q=${encodeURIComponent(query)}&multi_source=true&merged=true`, source: 'registry.k8s.io' }
            ];

            resultsDiv.innerHTML = '';

            for (const source of sources) {
                try {
                    const startTime = Date.now();
                    const response = await fetch(source.endpoint);
                    const responseTime = Date.now() - startTime;
                    const data = await response.json();
                    
                    // è®¡ç®—è¯¥æºçš„ç»“æœæ•°é‡
                    let resultCount = 0;
                    if (data.results) {
                        resultCount = Array.isArray(data.results) ? data.results.length : 0;
                    }
                    if (data.multi_source_results) {
                        // å¦‚æœæ˜¯å¤šæºç»“æœï¼Œè®¡ç®—ç‰¹å®šæºçš„ç»“æœæ•°
                        const sourceResult = data.multi_source_results.find(r => 
                            r.Source === source.source || r.source === source.source
                        );
                        if (sourceResult && sourceResult.Results) {
                            resultCount = sourceResult.Results.length;
                        }
                    }
                    
                    const hasResults = resultCount > 0;
                    const status = hasResults ? 'success' : 'error';
                    const statusText = hasResults ? 'Success' : 'No Results';
                    
                    const resultCard = document.createElement('div');
                    resultCard.className = 'result-card';
                    resultCard.innerHTML = `
                        <div class="result-header">
                            <div class="result-title">${source.name}</div>
                            <div class="result-source status-indicator status-${status}">${statusText}</div>
                        </div>
                        <div class="api-endpoint">${source.endpoint}</div>
                        <div class="result-summary">
                            <div class="summary-item">
                                <span class="summary-label">HTTPçŠ¶æ€ç </span>
                                <span class="summary-value">${response.status}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">å“åº”æ—¶é—´</span>
                                <span class="summary-value">${responseTime}ms</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">ç»“æœæ•°é‡</span>
                                <span class="summary-value">${resultCount}</span>
                            </div>
                        </div>
                        <div class="result-content">å“åº”æ•°æ®:\n${JSON.stringify(data, null, 2)}</div>
                    `;
                    resultsDiv.appendChild(resultCard);
                    
                    // çŸ­æš‚å»¶è¿Ÿï¼Œé¿å…è¯·æ±‚è¿‡äºé¢‘ç¹
                    await new Promise(resolve => setTimeout(resolve, 300));
                } catch (error) {
                    const resultCard = document.createElement('div');
                    resultCard.className = 'result-card';
                    resultCard.innerHTML = `
                        <div class="result-header">
                            <div class="result-title">${source.name}</div>
                            <div class="result-source status-indicator status-error">Error</div>
                        </div>
                        <div class="api-endpoint">${source.endpoint}</div>
                        <div class="result-summary">
                            <div class="summary-item">
                                <span class="summary-label">é”™è¯¯ä¿¡æ¯</span>
                                <span class="summary-value">è¯·æ±‚å¤±è´¥</span>
                            </div>
                        </div>
                        <div class="result-content">é”™è¯¯è¯¦æƒ…:\n${error.message}</div>
                    `;
                    resultsDiv.appendChild(resultCard);
                }
            }
        }

        function displayResult(container, title, source, data, statusCode) {
            const hasResults = data && ((Array.isArray(data.results) && data.results.length > 0) || 
                                       (data.multi_source_results && data.multi_source_results.length > 0) ||
                                       (Array.isArray(data) && data.length > 0));
            const status = hasResults ? 'success' : 'error';
            const statusText = hasResults ? 'Success' : 'No Results';
            
            // è®¡ç®—ç»“æœæ‘˜è¦
            let resultCount = 0;
            let sourceCount = 0;
            if (data.results) {
                resultCount = Array.isArray(data.results) ? data.results.length : 0;
            }
            if (data.multi_source_results) {
                sourceCount = Array.isArray(data.multi_source_results) ? data.multi_source_results.length : 0;
                // è®¡ç®—æ‰€æœ‰æºçš„æ€»ç»“æœæ•°
                resultCount = data.multi_source_results.reduce((sum, sourceRes) => 
                    sum + (Array.isArray(sourceRes.Results) ? sourceRes.Results.length : 0), 0);
            }
            
            container.innerHTML = `
                <div class="result-card">
                    <div class="result-header">
                        <div class="result-title">${title}</div>
                        <div class="result-source status-indicator status-${status}">${statusText}</div>
                    </div>
                    <div class="result-summary">
                        <div class="summary-item">
                            <span class="summary-label">HTTPçŠ¶æ€ç </span>
                            <span class="summary-value">${statusCode}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">ç»“æœæ•°é‡</span>
                            <span class="summary-value">${resultCount}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">æ•°æ®æºæ•°é‡</span>
                            <span class="summary-value">${sourceCount || 1}</span>
                        </div>
                    </div>
                    <div class="result-content">å“åº”æ•°æ®:\n${JSON.stringify(data, null, 2)}</div>
                </div>
            `;
        }

        // URLå‚æ•°è§£æå‡½æ•°
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                q: params.get('q') || '',
                page: params.get('page') || '1',
                page_size: params.get('page_size') || '25',
                multi_source: params.get('multi_source') !== null,
                merged: params.get('merged') !== null
            };
        }

        // æ„å»ºAPIç«¯ç‚¹URL
        function buildApiUrl(params) {
            let url = '/search?q=' + encodeURIComponent(params.q);
            if (params.page) url += `&page=${params.page}`;
            if (params.page_size) url += `&page_size=${params.page_size}`;
            if (params.multi_source) url += '&multi_source=true';
            if (params.merged) url += '&merged=true';
            return url;
        }

        // æ ¹æ®URLå‚æ•°è‡ªåŠ¨æ‰§è¡Œæœç´¢
        window.addEventListener('load', () => {
            // æ£€æŸ¥URLæ˜¯å¦åŒ…å«æˆ‘ä»¬å…³å¿ƒçš„æœç´¢å‚æ•°
            const urlParams = new URLSearchParams(window.location.search);
            const hasSearchParams = urlParams.has('q') || urlParams.has('page') || urlParams.has('page_size') || 
                                   urlParams.has('multi_source') || urlParams.has('merged');
                                    
            if (hasSearchParams) {
                const params = getUrlParams();
                if (params.q && params.q.trim() !== '') {
                    document.getElementById('searchQuery').value = params.q;
                    
                    // è®¾ç½®é¡µé¢ä¸­çš„å…¶ä»–å‚æ•°
                    if (params.page) document.getElementById('searchPage').value = params.page;
                    if (params.page_size) document.getElementById('searchPageSize').value = params.page_size;
                    if (params.multi_source) document.getElementById('searchMultiSource').checked = true;
                    if (params.merged) document.getElementById('searchMerged').checked = true;
                    
                    // æ ¹æ®å‚æ•°è‡ªåŠ¨æ‰§è¡Œç›¸åº”çš„æœç´¢ç±»å‹ï¼ˆä»…åœ¨é¡µé¢åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡ï¼‰
                    setTimeout(() => {
                        if (params.multi_source && params.merged) {
                            testWithParams(); // ä½¿ç”¨å¸¦å‚æ•°çš„æœç´¢
                        } else if (params.multi_source) {
                            testWithParams(); // ä½¿ç”¨å¸¦å‚æ•°çš„æœç´¢
                        } else {
                            testWithParams(); // ä½¿ç”¨å¸¦å‚æ•°çš„æœç´¢
                        }
                    }, 100); // ç¨å¾®å»¶æ—¶ä»¥ç¡®ä¿UIå…ƒç´ å·²å®Œå…¨åŠ è½½
                }
            }
        });

        // æ›´æ–°æµè§ˆå™¨URLè€Œä¸åˆ·æ–°é¡µé¢
        function updateUrl(params) {
            const queryString = Object.keys(params)
                .filter(key => params[key] !== '' && params[key] !== false)
                .map(key => `${key}=${encodeURIComponent(params[key])}`)
                .join('&');
            
            const newUrl = queryString ? `?${queryString}` : '?';
            window.history.replaceState({}, '', newUrl);
        }

        // äº‹ä»¶ç›‘å¬å™¨
        document.getElementById('testSingle').addEventListener('click', testSingleSearch);
        document.getElementById('testMultiSeparate').addEventListener('click', testMultiSeparateSearch);
        document.getElementById('testMultiMerged').addEventListener('click', testMultiMergedSearch);
        document.getElementById('testAllSources').addEventListener('click', testIndividualSources);

        // å›è½¦é”®æœç´¢
        document.getElementById('searchQuery').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                testSingleSearch();
            }
        });

        // æ·»åŠ é«˜çº§æœç´¢é€‰é¡¹
        document.querySelector('.search-section').insertAdjacentHTML('beforeend', `
            <div class="form-group" style="margin-top: 1rem;">
                <div class="input-group">
                    <label for="searchPage">é¡µç </label>
                    <input type="number" id="searchPage" placeholder="é¡µç ï¼Œé»˜è®¤1" value="1" min="1">
                </div>
                <div class="input-group">
                    <label for="searchPageSize">æ¯é¡µå¤§å°</label>
                    <input type="number" id="searchPageSize" placeholder="æ¯é¡µç»“æœæ•°ï¼Œé»˜è®¤25" value="25" min="1" max="100">
                </div>
                <div class="input-group" style="align-self: flex-end;">
                    <label>
                        <input type="checkbox" id="searchMultiSource"> å¤šæºæœç´¢
                    </label>
                </div>
                <div class="input-group" style="align-self: flex-end;">
                    <label>
                        <input type="checkbox" id="searchMerged"> åˆå¹¶ç»“æœ
                    </label>
                </div>
            </div>
            <div class="btn-group" style="margin-top: 1rem;">
                <button id="testWithParams">ä½¿ç”¨å‚æ•°æœç´¢</button>
            </div>
        `);

        // ä½¿ç”¨å‚æ•°æœç´¢å‡½æ•°
        async function testWithParams() {
            const query = document.getElementById('searchQuery').value.trim();
            if (!query) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }

            const page = document.getElementById('searchPage').value || '1';
            const pageSize = document.getElementById('searchPageSize').value || '25';
            const multiSource = document.getElementById('searchMultiSource').checked;
            const merged = document.getElementById('searchMerged').checked;

            // æ›´æ–°URLå‚æ•°
            const params = { q: query, page, page_size: pageSize };
            if (multiSource) params.multi_source = true;
            if (merged) params.merged = true;
            updateUrl(params);

            const resultsDiv = document.getElementById('singleResults');
            resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div>æ­£åœ¨æœç´¢...</div>';

            try {
                const startTime = Date.now();
                const apiUrl = buildApiUrl(params);
                const response = await fetch(apiUrl);
                const responseTime = Date.now() - startTime;
                const data = await response.json();
                
                const hasResults = data && ((Array.isArray(data.results) && data.results.length > 0) || 
                                           (data.multi_source_results && data.multi_source_results.length > 0) ||
                                           (Array.isArray(data) && data.length > 0));
                const status = hasResults ? 'success' : 'error';
                const statusText = hasResults ? 'Success' : 'No Results';
                
                // è®¡ç®—ç»“æœæ‘˜è¦
                let resultCount = 0;
                let sourceCount = 0;
                if (data.results) {
                    resultCount = Array.isArray(data.results) ? data.results.length : 0;
                }
                if (data.multi_source_results) {
                    sourceCount = Array.isArray(data.multi_source_results) ? data.multi_source_results.length : 0;
                    // è®¡ç®—æ‰€æœ‰æºçš„æ€»ç»“æœæ•°
                    resultCount = data.multi_source_results.reduce((sum, sourceRes) => 
                        sum + (Array.isArray(sourceRes.Results) ? sourceRes.Results.length : 0), 0);
                }
                
                resultsDiv.innerHTML = `
                    <div class="result-card">
                        <div class="result-header">
                            <div class="result-title">å¸¦å‚æ•°æœç´¢</div>
                            <div class="result-source status-indicator status-${status}">${statusText}</div>
                        </div>
                        <div class="api-endpoint">${apiUrl}</div>
                        <div class="result-summary">
                            <div class="summary-item">
                                <span class="summary-label">HTTPçŠ¶æ€ç </span>
                                <span class="summary-value">${response.status}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">å“åº”æ—¶é—´</span>
                                <span class="summary-value">${responseTime}ms</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">ç»“æœæ•°é‡</span>
                                <span class="summary-value">${resultCount}</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">æ•°æ®æºæ•°é‡</span>
                                <span class="summary-value">${sourceCount || 1}</span>
                            </div>
                        </div>
                        <div class="result-content">å“åº”æ•°æ®:\n${JSON.stringify(data, null, 2)}</div>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="result-card">
                    <div class="result-header">
                        <div class="result-title">å¸¦å‚æ•°æœç´¢</div>
                        <div class="result-source status-indicator status-error">Error</div>
                    </div>
                    <div class="api-endpoint">${buildApiUrl({q: query, page, page_size: pageSize, multi_source: multiSource, merged})}</div>
                    <div class="result-content">${error.message}</div>
                </div>`;
            }
        }

        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
                 
        const savedTheme = localStorage.getItem('theme');
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
            html.classList.add('dark');
            themeToggle.textContent = 'â˜€ï¸';
        }
        
        themeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            const isDark = html.classList.contains('dark');
            themeToggle.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });
        
        // ç§»åŠ¨ç«¯èœå•åŠŸèƒ½
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const navLinks = document.getElementById('navLinks');
        
        if (mobileMenuToggle && navLinks) {
            mobileMenuToggle.addEventListener('click', () => {
                navLinks.classList.toggle('active');
                mobileMenuToggle.textContent = navLinks.classList.contains('active') ? 'âœ•' : 'â˜°';
            });
            
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.navbar') && navLinks && navLinks.classList.contains('active')) {
                    navLinks.classList.remove('active');
                    mobileMenuToggle.textContent = 'â˜°';
                }
            });
        }
    </script>
</body>
</html>